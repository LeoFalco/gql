# Migration `20200907153246-2020-09-07_12-32-41-1599492761`

This migration has been generated by Leo Falco at 9/7/2020, 12:32:46 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE `gql`.`cliente` (
`id` varchar(191)  NOT NULL ,
`nome` varchar(191)  NOT NULL ,
`telefone` varchar(191)  NOT NULL ,
`enderecoId` varchar(191)  NOT NULL ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `gql`.`produto` (
`id` varchar(191)  NOT NULL ,
`descricao` varchar(191)  NOT NULL ,
`codigo` varchar(191)  ,
`preco` decimal(65,30)  NOT NULL ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `gql`.`item` (
`id` varchar(191)  NOT NULL ,
`descricao` varchar(191)  NOT NULL ,
`quantidade` decimal(65,30)  NOT NULL ,
`precoUnitario` decimal(65,30)  NOT NULL ,
`valor` decimal(65,30)  NOT NULL ,
`cancelado` boolean  NOT NULL ,
`produtoId` varchar(191)  NOT NULL ,
`atendimentoId` varchar(191)  NOT NULL ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `gql`.`finalizadora` (
`id` varchar(191)  NOT NULL ,
`descricao` varchar(191)  NOT NULL ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `gql`.`pagamento` (
`id` varchar(191)  NOT NULL ,
`valor` decimal(65,30)  NOT NULL ,
`troco` decimal(65,30)  NOT NULL ,
`cancelado` boolean  NOT NULL DEFAULT false,
`finalizadoraId` varchar(191)  NOT NULL ,
`atendimentoId` varchar(191)  NOT NULL ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `gql`.`endereco` (
`id` varchar(191)  NOT NULL ,
`logradouro` varchar(191)  NOT NULL ,
`bairro` varchar(191)  NOT NULL ,
`cidade` varchar(191)  NOT NULL ,
`cep` varchar(191)  NOT NULL ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `gql`.`atendimento` (
`id` varchar(191)  NOT NULL ,
`dataAbertura` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`dataEncerramento` datetime(3)  ,
`status` ENUM('ABERTO', 'CONFIRMADO', 'EM_ENTREGA', 'RECEBIDO', 'CANCELADO')  NOT NULL DEFAULT 'ABERTO',
`valorPedido` decimal(65,30)  NOT NULL DEFAULT 0,
`valorEntrega` decimal(65,30)  NOT NULL DEFAULT 0,
`valorTotal` decimal(65,30)  NOT NULL DEFAULT 0,
`valorPago` decimal(65,30)  NOT NULL DEFAULT 0,
`arquivado` boolean  NOT NULL DEFAULT false,
`clienteId` varchar(191)  ,
`enderecoId` varchar(191)  ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

ALTER TABLE `gql`.`cliente` ADD FOREIGN KEY (`enderecoId`) REFERENCES `gql`.`endereco`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `gql`.`item` ADD FOREIGN KEY (`produtoId`) REFERENCES `gql`.`produto`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `gql`.`item` ADD FOREIGN KEY (`atendimentoId`) REFERENCES `gql`.`atendimento`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `gql`.`pagamento` ADD FOREIGN KEY (`finalizadoraId`) REFERENCES `gql`.`finalizadora`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `gql`.`pagamento` ADD FOREIGN KEY (`atendimentoId`) REFERENCES `gql`.`atendimento`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `gql`.`atendimento` ADD FOREIGN KEY (`clienteId`) REFERENCES `gql`.`cliente`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `gql`.`atendimento` ADD FOREIGN KEY (`enderecoId`) REFERENCES `gql`.`endereco`(`id`) ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200907153246-2020-09-07_12-32-41-1599492761
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,92 @@
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "mysql"
+  url = "***"
+}
+
+enum Status {
+  ABERTO
+  CONFIRMADO
+  EM_ENTREGA
+  RECEBIDO
+  CANCELADO
+}
+
+model Cliente {
+  id       String   @id @default(cuid())
+  nome     String
+  telefone String
+  endereco Endereco
+  @@map("cliente")
+}
+
+model Produto {
+  id        String  @id @default(cuid())
+  descricao String
+  codigo    String?
+  preco     Float
+
+  @@map("produto")
+}
+
+model Item {
+  id            String      @id @default(cuid())
+  descricao     String
+  quantidade    Float
+  precoUnitario Float
+  valor         Float
+  cancelado     Boolean
+  produto       Produto
+  atendimento   Atendimento @relation(references: [id])
+
+  @@map("item")
+}
+
+model Finalizadora {
+  id        String @id @default(cuid())
+  descricao String
+
+  @@map("finalizadora")
+}
+
+model Pagamento {
+  id           String       @id @default(cuid())
+  valor        Float
+  troco        Float
+  cancelado    Boolean      @default(false)
+  finalizadora Finalizadora
+  atendimento  Atendimento  @relation(references: [id])
+
+  @@map("pagamento")
+}
+
+model Endereco {
+  id         String @id @default(cuid())
+  logradouro String
+  bairro     String
+  cidade     String
+  cep        String
+
+  @@map("endereco")
+}
+
+model Atendimento {
+  id               String      @id @default(cuid())
+  cliente          Cliente?
+  dataAbertura     DateTime    @default(now())
+  dataEncerramento DateTime?
+  status           Status      @default(ABERTO)
+  itens            Item[]
+  pagamentos       Pagamento[]
+  valorPedido      Float       @default(0)
+  valorEntrega     Float       @default(0)
+  valorTotal       Float       @default(0)
+  valorPago        Float       @default(0)
+  enderecoEntrega  Endereco?
+  arquivado        Boolean     @default(false)
+
+  @@map("atendimento")
+}
```


